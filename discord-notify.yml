name: Discord notify

on:
  push:
    branches: [ "main" ]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send message to Discord
        env:
          WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          REPO: ${{ github.repository }}
          ACTOR: ${{ github.actor }}
          MSG: ${{ github.event.head_commit.message }}
          URL: ${{ github.event.head_commit.url }}
        run: |
          payload=$(jq -n \
            --arg content "ğŸš€ **$REPO** updated by **$ACTOR**\nğŸ“ $MSG\nğŸ”— $URL" \
            '{content: $content}')
          curl -H "Content-Type: application/json" -d "$payload" "$WEBHOOK"
